(()=>{"use strict";var e={20:(e,t,s)=>{var r=s(609),o=Symbol.for("react.element"),n=(Symbol.for("react.fragment"),Object.prototype.hasOwnProperty),a=r.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,d={key:!0,ref:!0,__self:!0,__source:!0};t.jsx=function(e,t,s){var r,l={},i=null,c=null;for(r in void 0!==s&&(i=""+s),void 0!==t.key&&(i=""+t.key),void 0!==t.ref&&(c=t.ref),t)n.call(t,r)&&!d.hasOwnProperty(r)&&(l[r]=t[r]);if(e&&e.defaultProps)for(r in t=e.defaultProps)void 0===l[r]&&(l[r]=t[r]);return{$$typeof:o,type:e,key:i,ref:c,props:l,_owner:a.current}}},609:e=>{e.exports=window.React},848:(e,t,s)=>{e.exports=s(20)}},t={};function s(r){var o=t[r];if(void 0!==o)return o.exports;var n=t[r]={exports:{}};return e[r](n,n.exports,s),n.exports}const r=window.wc.blocksCheckout,o=JSON.parse('{"$schema":"https://schemas.wp.org/trunk/block.json","apiVersion":3,"name":"postcode-eu-address-validation/shipping-address-autocomplete","version":"1.0.0","title":"International Address Autocomplete","category":"woocommerce","description":"Autocomplete international addresses using the Postcode.eu API.","example":{},"parent":["woocommerce/checkout-shipping-address-block"],"attributes":{"lock":{"type":"object","default":{"remove":true,"move":true}}},"textdomain":"postcode-eu-address-validation"}');var n=s(609);const a=window.wp.data,d=window.wp.element,l=window.wc.wcBlocksData,i=window.wc.wcSettings,c=window.wp.i18n,u=window.wc.blocksComponents;function p(e){return["address_1","city","postcode"].every((t=>void 0===(0,a.select)(l.VALIDATION_STORE_KEY).getValidationError(`${e}_${t}`)))}function m({country:e,address_1:t,address_2:s,postcode:r,city:o}){return((e,t,s,r)=>{const o=j.actions.validate.replace("${country}",encodeURIComponent(e)).replace("${streetAndBuilding}",encodeURIComponent(t)).replace("${postcode}",encodeURIComponent(s)).replace("${locality}",encodeURIComponent(r));return fetch(o).then((e=>{if(e.ok)return e.json();throw new Error(e.statusText)}))})(j.enabledCountries[e].iso3,`${t} ${s}`.trim(),r,o).then((e=>{const t=e.matches[0];return t?.status&&!t.status.isAmbiguous&&t.status.grade<"C"&&["Building","BuildingPartial"].includes(t.status.validationLevel)?t:null})).catch((e=>console.error(e)))}function E(e){const t=[...e.matchAll(/[1-9]\d{0,4}\D*/g)];return 0===t[0]?.index&&t.shift(),1===t.length?t[0][0].trim():null}var f,h;function g(e){return(0,d.useMemo)((()=>({storageKey:"postcode-eu-validated-address-"+e,get(){var e;return null!==(e=JSON.parse(window.localStorage.getItem(this.storageKey)))&&void 0!==e?e:null},set({address_1:e,postcode:t,city:s},r){const o={timestamp:Date.now(),values:{address_1:e,postcode:t,city:s},mailLines:r};window.localStorage.setItem(this.storageKey,JSON.stringify(o))},isEqual(e){const t=this.get()?.values;return null!=t&&t&&Object.entries(t).every((([t,s])=>e[t]===s))},isExpired(){const e=JSON.parse(window.localStorage.getItem(this.storageKey));return e?.timestamp+7776e6<Date.now()},clear(){window.localStorage.removeItem(this.storageKey)}})),[e])}null!==(h=(f=PostcodeNl).addressDetailsCache)&&void 0!==h||(f.addressDetailsCache=new Map);let _=!1;const v=({id:e,addressType:t,address:s,setAddress:r,setFormattedAddress:o,addressRef:i,resetAddress:E})=>{const f=(0,d.useRef)(null),[h,v]=(0,d.useState)(!1),[y,A]=(0,d.useState)(!1),[w,I]=(0,d.useState)((()=>(e=>["postcode","city","address_1","address_2"].map((t=>e[t])).join(" ").trim())(s))),{setValidationErrors:b,clearValidationError:C}=(0,a.useDispatch)(l.VALIDATION_STORE_KEY),S=function(e){const t=(0,d.useRef)(null),s=(0,d.useCallback)((e=>PostcodeNl.addressDetailsCache.has(e)?Promise.resolve(PostcodeNl.addressDetailsCache.get(e)):new Promise((s=>{t.current.getDetails(e,(t=>{s(t),PostcodeNl.addressDetailsCache.set(e,t)}))}))),[]),r=(0,d.useCallback)(((...s)=>t.current.search(e.current,...s)),[e]);return(0,d.useEffect)((()=>(t.current=new PostcodeNl.AutocompleteAddress(e.current,{autocompleteUrl:j.actions.autocomplete,addressDetailsUrl:j.actions.getDetails}),t.current.getSuggestions=function(e,t,s){const r=(new TextEncoder).encode(t),o=Array.from(r,(e=>String.fromCodePoint(e))).join(""),n=this.options.autocompleteUrl.replace("${context}",encodeURIComponent(e)).replace("${term}",encodeURIComponent(btoa(o)));return this.xhrGet(`${n}`,s)},t.current.getDetails=function(e,t){const s=this.options.addressDetailsUrl.replace("${context}",encodeURIComponent(e));return this.xhrGet(s,t)},()=>t.current.destroy())),[e]),(0,d.useMemo)((()=>({instanceRef:t,getAddressDetails:s,search:r})),[t,s,r])}(f,s.country),N=g(t),{validationError:O,validationErrorId:R}=(0,a.useSelect)((t=>{const s=t(l.VALIDATION_STORE_KEY);return{validationError:s.getValidationError(e),validationErrorId:s.getValidationErrorId(e)}})),T=(0,d.useCallback)(((s=!0)=>{p(t)?C(e):b({[e]:{message:(0,c.__)("Please enter an address and select it","postcode-eu-address-validation"),hidden:s}})}),[t,e,C,b]),$=(0,d.useCallback)((t=>{v(!0),S.getAddressDetails(t.context).then((t=>{const{locality:s,postcode:n}=t.address;r({...i.current,address_1:t.streetLine,city:s,postcode:n},t.mailLines),"default"===j.displayMode&&o(t.mailLines.join("\n")),C(e)})).finally((()=>v(!1)))}),[S,r,i,o,C,e]),k=(0,d.useCallback)((()=>{p(t)&&(v(!0),m(i.current).then((e=>{if(null===e)r({...i.current,address_1:"",city:"",postcode:""}),T(!0);else{const{locality:t,postcode:s}=e.address;r({...i.current,address_1:e.streetLine,city:t,postcode:s},e.mailLines),"default"===j.displayMode&&o(e.mailLines.join("\n"))}})).finally((()=>v(!1))))}),[i,t,r,o,T]);(0,d.useEffect)((()=>{f.current.addEventListener("autocomplete-select",(e=>{I(e.detail.value),"Address"===e.detail.precision&&$(e.detail)})),f.current.addEventListener("autocomplete-search",E),f.current.addEventListener("autocomplete-error",(()=>{v(!1),b({[e]:{message:(0,c.__)("An error has occurred while retrieving address data. Please contact us if the problem persists.","postcode-eu-address-validation"),hidden:!1}})})),f.current.addEventListener("autocomplete-open",(()=>A(!0))),f.current.addEventListener("autocomplete-close",(()=>A(!1)))}),[I,E,v,b,A,$,e]),(0,d.useEffect)((()=>{var t;_&&(S.instanceRef.current.reset(),I(""),E()),S.instanceRef.current.setCountry(j.enabledCountries[s.country].iso3);const r=(0,a.select)(l.VALIDATION_STORE_KEY).getValidationError(e);T(null===(t=r?.hidden)||void 0===t||t)}),[S.instanceRef,s.country,E,I,e,T]),(0,d.useEffect)((()=>()=>C(e)),[C,e]),(0,d.useEffect)((()=>{const e=`${S.instanceRef.current.options.cssPrefix}loading`;f.current.classList.toggle(e,h)}),[S.instanceRef,h]),(0,d.useEffect)((()=>{_||(!N.isExpired()&&N.isEqual(i.current)?o(N.get().mailLines.join("\n")):k())}),[i,k,o,N]),(0,d.useEffect)((()=>{_=!0}),[]);const D=O?.message&&!O?.hidden;return(0,n.createElement)(u.TextInput,{id:e,required:!0,className:{"has-error":D},ref:f,label:(0,c.__)("Start typing your address or zip/postal code","postcode-eu-address-validation"),value:w,onChange:e=>{T(!0),I(e)},onBlur:()=>!y&&T(!1),"aria-invalid":!0===D,ariaDescribedBy:D&&R?R:null,feedback:(0,n.createElement)(u.ValidationInputError,{propertyName:e,elementId:e}),title:""})},y=(0,d.forwardRef)((function({icon:e,size:t=24,...s},r){return(0,d.cloneElement)(e,{width:t,height:t,...s,ref:r})})),A=window.wp.primitives;var w=s(848);const I=(0,w.jsx)(A.SVG,{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",children:(0,w.jsx)(A.Path,{d:"m19 7-3-3-8.5 8.5-1 4 4-1L19 7Zm-7 11.5H5V20h7v-1.5Z"})}),b=({forId:e,onClick:t})=>{const s=(0,a.useSelect)((t=>t(l.VALIDATION_STORE_KEY).getValidationError(e))),{clearValidationError:r}=(0,a.useDispatch)(l.VALIDATION_STORE_KEY);return s&&!s.hidden?(0,n.createElement)("span",{className:"postcode-eu-autofill-intl-bypass"},(0,n.createElement)(y,{icon:I}),(0,n.createElement)("a",{onClick:()=>{r(e),t()}},(0,c.__)("Enter an address"))):null},C=/([1-9]\d{3})\s*([A-Z]{2})/i,S=/([1-9]\d{0,4})(\D.*)?$/i,N=Object.freeze({VALID:"valid",NOT_FOUND:"notFound",ADDITION_INCORRECT:"houseNumberAdditionIncorrect"}),O="_",R=(e,t)=>{const s=j.actions.dutchAddressLookup.replace("${postcode}",encodeURIComponent(e)).replace("${houseNumberAndAddition}",encodeURIComponent(t));return fetch(s).then((e=>{if(e.ok)return e.json();throw new Error(e.statusText)}))},T=({addressType:e,address:t,setAddress:s,setFormattedAddress:r,addressRef:o,resetAddress:i})=>{var m;const f=`${e}-postcode-eu-postcode`,h=`${e}-postcode-eu-house_number`,_=`${e}-postcode-eu-house_number_select`,v=`${e}-postcode-eu-address-lookup-error`,[y,A]=(0,d.useState)(null!==(m=t.postcode)&&void 0!==m?m:""),[w,I]=(0,d.useState)((()=>(({address_1:e,address_2:t})=>{var s;return null!==(s=E(`${e} ${t}`))&&void 0!==s?s:""})(t))),[b,T]=(0,d.useState)(O),[$,k]=(0,d.useState)([]),[D,x]=(0,d.useState)(null),[P,K]=(0,d.useState)(null),[U,B]=(0,d.useState)(!1),[M,Y]=(0,d.useState)({status:null,address:null}),F=(0,d.useRef)(),{setValidationErrors:H,clearValidationError:Z}=(0,a.useDispatch)(l.VALIDATION_STORE_KEY),q=g(e),G=(0,d.useRef)(!q.isExpired()&&q.isEqual(o.current)),z=(0,d.useCallback)((()=>p(e)),[e]),J=(0,d.useCallback)((e=>{const t=C.exec(e.value);return x(null===t?null:t[1]+t[2]),z()||null!==t}),[z]),W=(0,d.useCallback)((e=>{var t;const s=S.exec(e.value);return K(null===s?null:`${s[1]} ${null!==(t=s[2]?.trim())&&void 0!==t?t:""}`.trim()),z()||null!==s}),[z]),Q=(0,d.useCallback)((({status:e,address:t})=>{Z(v),e===N.NOT_FOUND?H({[v]:{message:(0,c.__)("Address not found.","postcode-eu-address-validation"),hidden:!1}}):e===N.ADDITION_INCORRECT&&k(t.houseNumberAdditions.map((e=>({value:e,label:`${t.houseNumber} ${e}`.trim()}))))}),[Z,v,H,k]);return(0,d.useEffect)((()=>{if(G.current||(i(),k([]),T(O)),null!==D&&null!==P){if(!G.current)return F.current=window.setTimeout((()=>{B(!0),R(D,P).then((e=>{Q(e),Y(e)})).catch((()=>{H({[v]:{message:(0,c.__)("An error has occurred. Please try again later or contact us.","postcode-eu-address-validation"),hidden:!1}})})).finally((()=>B(!1)))}),750),()=>window.clearTimeout(F.current);G.current=!1}}),[i,k,T,D,P,B,Q,Y,H,v]),(0,d.useEffect)((()=>{if(G.current)return void r(q.get().mailLines.join("\n"));const{status:e,address:t}=M;if(e===N.VALID){var n;const e=`${t.houseNumber} ${null!==(n=t.houseNumberAddition)&&void 0!==n?n:""}`.trim(),a=[`${t.street} ${e}`,`${t.postcode} ${t.city}`];s({...o.current,address_1:`${t.street} ${e}`,city:t.city,postcode:t.postcode},a),"default"===j.displayMode&&r(a.join("\n"))}else i(),r(null)}),[M,r,q,s,o,i]),(0,d.useEffect)((()=>()=>Z(v)),[Z,v]),(0,d.useEffect)((()=>{G.current||Y((e=>{if(null===e.address)return e;const t=b===O;return{address:{...e.address,houseNumberAddition:t?null:b},status:t?null:N.VALID}}))}),[b,Y]),(0,n.createElement)(n.Fragment,null,(0,n.createElement)(u.ValidatedTextInput,{id:f,label:(0,c.__)("Postcode","postcode-eu-address-validation"),value:y,onChange:A,customValidation:J,errorMessage:(0,c.__)("Please enter a valid postcode","postcode-eu-address-validation")}),(0,n.createElement)(u.ValidatedTextInput,{id:h,label:(0,c.__)("House number and addition","postcode-eu-address-validation"),value:w,onChange:I,customValidation:W,errorMessage:(0,c.__)("Please enter a valid house number","postcode-eu-address-validation")}),$.length>0&&(0,n.createElement)(V,{id:_,options:$,value:b,onChange:T}),(0,n.createElement)("div",{className:"postcode-eu-address-lookup-status"},U&&(0,n.createElement)(u.Spinner,null),(0,n.createElement)(L,{id:v})))};function $(e){var t,s,r="";if("string"==typeof e||"number"==typeof e)r+=e;else if("object"==typeof e)if(Array.isArray(e)){var o=e.length;for(t=0;t<o;t++)e[t]&&(s=$(e[t]))&&(r&&(r+=" "),r+=s)}else for(s in e)e[s]&&(r&&(r+=" "),r+=s);return r}const k=function(){for(var e,t,s=0,r="",o=arguments.length;s<o;s++)(e=arguments[s])&&(t=$(e))&&(r&&(r+=" "),r+=t);return r},D=(0,w.jsx)(A.SVG,{viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",children:(0,w.jsx)(A.Path,{d:"M17.5 11.6L12 16l-5.5-4.4.9-1.2L12 14l4.5-3.6 1 1.2z"})}),V=({id:e,onChange:t,options:s=[],value:r=O})=>{const{setValidationErrors:o,clearValidationError:i}=(0,a.useDispatch)(l.VALIDATION_STORE_KEY),{validationError:p,validationErrorId:m}=(0,a.useSelect)((t=>{const s=t(l.VALIDATION_STORE_KEY);return{validationError:s.getValidationError(e),validationErrorId:s.getValidationErrorId(e)}}));(0,d.useEffect)((()=>(r===O?o({[e]:{message:(0,c.__)("Please select a house number","postcode-eu-address-validation"),hidden:!0}}):i(e),()=>i(e))),[r,e,o,i]);const E=p?.message&&!p?.hidden;return(0,n.createElement)("div",{className:k("postcode-eu-house-number-select",{"has-error":E})},(0,n.createElement)("div",{className:"wc-blocks-components-select"},(0,n.createElement)("div",{className:"wc-blocks-components-select__container"},(0,n.createElement)("label",{htmlFor:e,className:"wc-blocks-components-select__label"},(0,c.__)("Which house number do you mean?","postcode-eu-address-validation")),(0,n.createElement)("select",{className:"wc-blocks-components-select__select",id:e,onChange:e=>t(e.target.value),value:r,"aria-invalid":E,"aria-errormessage":m},(0,n.createElement)("option",{key:O,value:O},(0,c.__)("Select house number","postcode-eu-address-validation")),s.map((e=>(0,n.createElement)("option",{key:e.value,value:e.value},e.label)))),(0,n.createElement)(y,{className:"wc-blocks-components-select__expand",icon:D}))),(0,n.createElement)(u.ValidationInputError,{propertyName:e,elementId:e}))},x=(0,w.jsx)(A.SVG,{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",children:(0,w.jsx)(A.Path,{d:"M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM12.75 8V13H11.25V8H12.75ZM12.75 14.5V16H11.25V14.5H12.75Z"})}),L=({id:e})=>{const{error:t,errorId:s}=(0,a.useSelect)((t=>{const s=t(l.VALIDATION_STORE_KEY);return{error:s.getValidationError(e),errorId:s.getValidationErrorId(e)}}));return t?.hidden||!t?.message?null:(0,n.createElement)("div",{className:"postcode-eu-address-lookup-error",role:"alert"},(0,n.createElement)("p",{id:s},(0,n.createElement)(y,{icon:x}),(0,n.createElement)("span",null,t.message)))},P=({formattedAddress:e})=>e?(0,n.createElement)("address",{className:"postcode-eu-autofill-address"},e):null,j=(0,i.getSetting)("postcode-eu-address-validation_data"),K=({addressType:e,address:t,setAddress:s})=>{const r=(0,d.useRef)(null),o=(0,d.useRef)(t),[a,l]=(0,d.useState)(null),[i,c]=(0,d.useState)(!1),u=`${e}-postcode-eu-address_autocomplete`,p=Object.hasOwn(j.enabledCountries,t.country);o.current=t;const m=(0,d.useCallback)((()=>{s({...o.current,address_1:"",city:"",postcode:""}),l(null)}),[s,l]);(0,d.useEffect)((()=>{const t=()=>{const t=document.getElementById(`${e}-address_1`)?.parentElement;return t?.before(r.current),t};if(!t()){const e=new MutationObserver((s=>{s.forEach((()=>{t()&&e.disconnect()}))}));return e.observe(r.current.closest(".wc-block-components-checkout-step__content"),{childList:!0}),()=>e.disconnect()}}),[e]),(0,d.useEffect)((()=>{if("showAll"!==j.displayMode)for(const t of["address_1","postcode","city"]){const s=document.getElementById(`${e}-${t}`)?.parentElement;s&&(s.style.display=i?"none":"")}}),[e,i]),(0,d.useEffect)((()=>{c(p)}),[c,p]);const E={addressType:e,address:t,setAddress:s,setFormattedAddress:l,addressRef:o,resetAddress:m};return(0,n.createElement)("div",{className:"postcode-eu-autofill-container",ref:r,style:i?{}:{display:"none"}},p&&(0,n.createElement)(n.Fragment,null,"NL"===t.country&&"postcodeOnly"===j.netherlandsMode?(0,n.createElement)(T,{...E}):(0,n.createElement)(v,{id:u,...E}),"y"===j.allowAutofillIntlBypass&&"showAll"!==j.displayMode&&(0,n.createElement)(b,{forId:u,onClick:()=>c(!1)}),(0,n.createElement)(P,{formattedAddress:a})))},U=({isEditingAddress:e,setIsEditingAddress:t,setAddress:s,...r})=>{const o=g(r.addressType),a=(0,d.useRef)(),l=(0,d.useRef)();a.current=r.address,l.current=e;const i=(0,d.useCallback)(((e,t=null)=>{["address_1","city","postcode"].some((t=>""===e[t]))?o.clear():o.set(e,t),s(e)}),[o,s]);return(0,d.useEffect)((()=>{const e=j.enabledCountries[a.current.country];if(e&&!l.current&&(o.isExpired()||!o.isEqual(a.current))){if(o.clear(),"NL"===e.iso2&&"postcodeOnly"===j.netherlandsMode){const{address_1:e,address_2:s,postcode:r}=a.current,o=E(`${e} ${s}`);if(null!==o)return void R(r,o).then((e=>{const{status:s,address:r}=e;if("valid"===s){var o;const e=`${r.houseNumber} ${null!==(o=r.houseNumberAddition)&&void 0!==o?o:""}`.trim();i({...a.current,address_1:`${r.street} ${e}`,city:r.city,postcode:r.postcode},[`${r.street} ${e}`,`${r.postcode} ${r.city}`])}else t(!0)})).catch((e=>console.error(e)))}m(a.current).then((e=>{if(null===e)t(!0),i({...a.current,address_1:"",city:"",postcode:""});else{const{address:t}=e;i({...a.current,address_1:`${t.street} ${t.building}`,city:t.locality,postcode:t.postcode},e.mailLines)}}))}}),[o,t,i]),e?(0,n.createElement)(K,{...r,setAddress:i}):null};(0,r.registerCheckoutBlock)({metadata:o,component:()=>{const{isUseShippingAsBilling:e,isEditingAddress:t}=(0,a.useSelect)((e=>({isUseShippingAsBilling:e(l.CHECKOUT_STORE_KEY).getUseShippingAsBilling(),isEditingAddress:e(l.CHECKOUT_STORE_KEY).getEditingShippingAddress()})),[]),{setEditingShippingAddress:s}=(0,a.useDispatch)(l.CHECKOUT_STORE_KEY),{shippingAddress:r}=(0,a.useSelect)((e=>e(l.CART_STORE_KEY).getCustomerData()),[]),{setShippingAddress:o,setBillingAddress:i}=(0,a.useDispatch)(l.CART_STORE_KEY),c=(0,d.useRef)();c.current=e;const u=(0,d.useCallback)((e=>{o(e),c.current&&i({...e})}),[o,i]);return(0,n.createElement)(U,{addressType:"shipping",address:r,setAddress:u,isEditingAddress:t,setIsEditingAddress:s})}})})();